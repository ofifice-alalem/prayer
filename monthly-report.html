<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù„ØµÙ„Ø§Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'arabic': ['Cairo', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
        }
        .day-cell {
            transition: all 0.2s ease;
        }
        .day-cell:hover {
            transform: scale(1.05);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }
        
        .modal.show .modal-content {
            transform: scale(1);
        }
        
        .today {
            animation: pulse-today 2s infinite;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }
        
        @keyframes pulse-today {
            0%, 100% {
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
            }
            50% {
                box-shadow: 0 0 0 6px rgba(59, 130, 246, 0.3);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen font-arabic">
    <style>
        @media (max-width: 500px) {
            .mobile-fixed { position: fixed; top: 0; left: 0; right: 0; z-index: 30; }
            .mobile-content { margin-top: 80px; }
        }
    </style>
    <!-- Modal Container -->
    <div id="modal" class="modal">
        <div class="modal-content bg-white rounded-2xl shadow-2xl p-4 sm:p-6 w-11/12 sm:w-96 max-w-md max-h-[90vh] border-r-4 flex flex-col" id="modal-card">
            <div class="flex items-start justify-between mb-4 flex-shrink-0">
                <h3 class="text-xl font-bold text-gray-800" id="modal-title"></h3>
                <button onclick="hideModal()" class="text-gray-400 hover:text-gray-600 text-2xl">Ã—</button>
            </div>
            <div id="modal-content" class="overflow-y-auto flex-1"></div>
        </div>
    </div>

    <div class="container mx-auto px-2 sm:px-4 py-2 sm:py-8 max-w-6xl">
        <!-- User Header -->
        <div class="bg-white rounded-2xl shadow-lg p-2 sm:p-4 mb-6 mobile-fixed">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 sm:gap-4">
                    <div class="w-10 sm:w-12 h-10 sm:h-12 rounded-full flex items-center justify-center text-xl sm:text-2xl" id="user-avatar"></div>
                    <div>
                        <div class="text-lg sm:text-xl font-bold" id="user-name"></div>
                        <div class="text-xs sm:text-sm text-gray-600">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</div>
                    </div>
                </div>
                <button onclick="toggleSidebar()" class="text-sm text-gray-500 hover:text-gray-700 hover:bg-gray-50 flex items-center gap-2 border-2 border-gray-200 rounded-xl px-5 py-2" style="padding: 5px 10px 5px 20px; border-radius: 10px; border: 2px solid #eee;">
                    <div class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center">
                        <span class="text-lg">ğŸ </span>
                    </div>
                    <span>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</span>
                </button>
            </div>
        </div>
        
        <!-- Header -->
        <div class="text-center mb-8 mobile-content">
            <div class="bg-white rounded-2xl shadow-lg p-4 mb-6">
                <div class="text-2xl font-bold" id="current-month"></div>
                <div class="text-lg text-gray-600">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ</div>
            </div>
            <h1 class="text-3xl font-bold text-gray-800 mb-2">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠ</h1>
            <p class="text-gray-600">Ù…ØªØ§Ø¨Ø¹Ø© Ø¥Ù†Ø¬Ø§Ø²Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø®Ù„Ø§Ù„ Ø§Ù„Ø´Ù‡Ø±</p>
        </div>



        <!-- Monthly Summary -->
        <div class="grid md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-2xl shadow-lg p-6 card-hover">
                <div class="text-center">
                    <div class="text-3xl font-bold text-green-600" id="month-fard">0%</div>
                    <div class="text-gray-700 font-medium">Ù…ØªÙˆØ³Ø· Ø§Ù„ÙØ±Ø§Ø¦Ø¶</div>
                </div>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6 card-hover">
                <div class="text-center">
                    <div class="text-3xl font-bold text-amber-600" id="month-nafl">0%</div>
                    <div class="text-gray-700 font-medium">Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†ÙˆØ§ÙÙ„</div>
                </div>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6 card-hover">
                <div class="text-center">
                    <div class="text-3xl font-bold text-blue-600" id="month-total">0%</div>
                    <div class="text-gray-700 font-medium">Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                </div>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6 card-hover">
                <div class="text-center">
                    <div class="text-3xl font-bold text-purple-600" id="perfect-days">0</div>
                    <div class="text-gray-700 font-medium">Ø£ÙŠØ§Ù… Ù…ÙƒØªÙ…Ù„Ø© â­</div>
                </div>
            </div>
        </div>

        <!-- Calendar Grid -->
        <div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø´Ù‡Ø±</h2>
            
            <!-- Days of Week Header -->
            <div class="grid grid-cols-7 gap-1 sm:gap-2 mb-4">
                <div class="text-center font-bold text-gray-600 p-1 sm:p-2 text-xs sm:text-sm">Ø§Ù„Ø£Ø­Ø¯</div>
                <div class="text-center font-bold text-gray-600 p-1 sm:p-2 text-xs sm:text-sm">Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</div>
                <div class="text-center font-bold text-gray-600 p-1 sm:p-2 text-xs sm:text-sm">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</div>
                <div class="text-center font-bold text-gray-600 p-1 sm:p-2 text-xs sm:text-sm">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</div>
                <div class="text-center font-bold text-gray-600 p-1 sm:p-2 text-xs sm:text-sm">Ø§Ù„Ø®Ù…ÙŠØ³</div>
                <div class="text-center font-bold text-gray-600 p-1 sm:p-2 text-xs sm:text-sm">Ø§Ù„Ø¬Ù…Ø¹Ø©</div>
                <div class="text-center font-bold text-gray-600 p-1 sm:p-2 text-xs sm:text-sm">Ø§Ù„Ø³Ø¨Øª</div>
            </div>
            
            <!-- Calendar Days -->
            <div class="grid grid-cols-7 gap-1 sm:gap-2" id="calendar-grid">
                <!-- Days will be generated by JavaScript -->
            </div>
        </div>

        <!-- Legend -->
        <div class="mt-6 bg-white rounded-2xl shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù„ÙˆØ§Ù†</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="flex items-center gap-2">
                    <div class="w-4 h-4 bg-green-500 rounded"></div>
                    <span class="text-sm">Ù…ÙƒØªÙ…Ù„ (100%)</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-4 h-4 bg-blue-500 rounded"></div>
                    <span class="text-sm">Ù…Ù…ØªØ§Ø² (80-99%)</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-4 h-4 bg-yellow-500 rounded"></div>
                    <span class="text-sm">Ø¬ÙŠØ¯ (50-79%)</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-4 h-4 bg-red-500 rounded"></div>
                    <span class="text-sm">ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ† (Ø£Ù‚Ù„ Ù…Ù† 50%)</span>
                </div>
            </div>
        </div>


    </div>

    <script>
        function getCurrentUser() {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                window.location.href = 'user-select.html';
                return null;
            }
            return currentUser;
        }
        
        function getUserProfile(username) {
            const profile = localStorage.getItem(`user_${username}`);
            return profile ? JSON.parse(profile) : null;
        }
        
        function loadMonthlyData() {
            const currentUser = getCurrentUser();
            if (!currentUser) return {};
            
            const now = new Date();
            const currentMonth = now.getMonth() + 1;
            const currentYear = now.getFullYear();
            const key = `prayers_${currentUser}_${currentYear}_${currentMonth}`;
            const stored = localStorage.getItem(key);
            return stored ? JSON.parse(stored) : {};
        }
        
        function isPrayerCompleted(prayerData) {
            return prayerData && (prayerData === true || prayerData.completed === true);
        }

        function getPerformanceColor(percentage) {
            if (percentage === 100) return 'bg-green-500';
            if (percentage >= 80) return 'bg-blue-500';
            if (percentage >= 50) return 'bg-yellow-500';
            return 'bg-red-500';
        }

        function generateCalendar() {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDay = new Date(year, month, 1).getDay();
            
            const calendarGrid = document.getElementById('calendar-grid');
            calendarGrid.innerHTML = '';

            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'p-2';
                calendarGrid.appendChild(emptyCell);
            }

            const today = now.getDate();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            const monthlyData = loadMonthlyData();
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayData = monthlyData[day] || {};
                const fardCount = ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'].filter(p => isPrayerCompleted(dayData[p])).length;
                const naflCount = ['fajr-sunnah', 'duha', 'witr'].filter(p => dayData[p]).length;
                const fardPercentage = Math.round((fardCount / 5) * 100);
                const naflPercentage = Math.round((naflCount / 3) * 100);
                const totalPercentage = Math.round(((fardCount + naflCount) / 8) * 100);
                
                // Check if no missed rakaat
                const hasNoMissedRakaat = ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'].every(p => {
                    const prayerData = dayData[p];
                    return !prayerData || prayerData === true || !prayerData.completed || prayerData.missedRakaat === 0;
                });
                
                const dayCell = document.createElement('div');
                const isFutureDay = (year === currentYear && month === currentMonth && day > today) || 
                                   (year === currentYear && month > currentMonth) || 
                                   (year > currentYear);
                const isToday = (year === currentYear && month === currentMonth && day === today);
                
                if (isFutureDay) {
                    dayCell.className = 'p-2 sm:p-3 rounded-lg border-2 border-gray-300 bg-white min-h-[60px] sm:min-h-[80px]';
                    dayCell.innerHTML = `
                        <div class="text-center text-gray-400">
                            <div class="font-bold text-sm sm:text-lg">${day}</div>
                        </div>
                    `;
                } else {
                    const todayClass = isToday ? ' today' : '';
                    dayCell.className = `day-cell p-2 sm:p-3 rounded-lg border-2 border-gray-200 cursor-pointer ${getPerformanceColor(totalPercentage)}${todayClass} min-h-[60px] sm:min-h-[80px]`;
                    dayCell.innerHTML = `
                        <div class="text-center text-white">
                            <div class="font-bold text-sm sm:text-lg">${day}</div>
                            <div class="text-xs mt-1 hidden sm:block">
                                <div>Ù: ${fardPercentage}%</div>
                                <div>Ù†: ${naflPercentage}%</div>
                            </div>
                            ${totalPercentage === 100 && hasNoMissedRakaat ? '<div class="text-yellow-400 text-sm sm:text-lg mt-1">â­</div>' : ''}
                        </div>
                    `;
                    
                    dayCell.addEventListener('click', () => {
                        showModal(day, {fard: fardCount, nafl: naflCount}, fardPercentage, naflPercentage, totalPercentage);
                    });
                }
                
                calendarGrid.appendChild(dayCell);
            }
        }

        function calculateMonthlyStats() {
            const monthlyData = loadMonthlyData();
            let totalFard = 0, totalNafl = 0, totalDays = 0, perfectDays = 0;
            
            Object.values(monthlyData).forEach(day => {
                const fardCount = ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'].filter(p => isPrayerCompleted(day[p])).length;
                const naflCount = ['fajr-sunnah', 'duha', 'witr'].filter(p => day[p]).length;
                totalFard += fardCount;
                totalNafl += naflCount;
                totalDays++;
                
                // Check if this day is perfect (8/8) with no missed rakaat
                const hasNoMissedRakaatStats = ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'].every(p => {
                    const prayerData = day[p];
                    return !prayerData || prayerData === true || !prayerData.completed || prayerData.missedRakaat === 0;
                });
                
                if (fardCount === 5 && naflCount === 3 && hasNoMissedRakaatStats) {
                    perfectDays++;
                }
            });
            
            if (totalDays === 0) {
                document.getElementById('month-fard').textContent = '0%';
                document.getElementById('month-nafl').textContent = '0%';
                document.getElementById('month-total').textContent = '0%';
                document.getElementById('perfect-days').textContent = '0';
                return;
            }
            
            const avgFard = Math.round((totalFard / (totalDays * 5)) * 100);
            const avgNafl = Math.round((totalNafl / (totalDays * 3)) * 100);
            const avgTotal = Math.round(((totalFard + totalNafl) / (totalDays * 8)) * 100);
            
            document.getElementById('month-fard').textContent = avgFard + '%';
            document.getElementById('month-nafl').textContent = avgNafl + '%';
            document.getElementById('month-total').textContent = avgTotal + '%';
            document.getElementById('perfect-days').textContent = perfectDays;
        }

        function updateCurrentMonth() {
            const now = new Date();
            const months = ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ', 'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'];
            document.getElementById('current-month').textContent = `${months[now.getMonth()]} ${now.getFullYear()}`;
        }

        function getDayName(day) {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            const date = new Date(year, month, day);
            const dayNames = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
            return dayNames[date.getDay()];
        }
        
        function showModal(day, dayData, fardPercentage, naflPercentage, totalPercentage) {
            const modal = document.getElementById('modal');
            const modalCard = document.getElementById('modal-card');
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');
            
            if (totalPercentage === 100) modalCard.className = 'modal-content bg-white rounded-2xl shadow-2xl p-6 w-11/12 md:w-[600px] max-w-2xl max-h-[90vh] border-r-4 border-green-500 flex flex-col';
            else if (totalPercentage >= 80) modalCard.className = 'modal-content bg-white rounded-2xl shadow-2xl p-6 w-11/12 md:w-[600px] max-w-2xl max-h-[90vh] border-r-4 border-blue-500 flex flex-col';
            else if (totalPercentage >= 50) modalCard.className = 'modal-content bg-white rounded-2xl shadow-2xl p-6 w-11/12 md:w-[600px] max-w-2xl max-h-[90vh] border-r-4 border-yellow-500 flex flex-col';
            else modalCard.className = 'modal-content bg-white rounded-2xl shadow-2xl p-6 w-11/12 md:w-[600px] max-w-2xl max-h-[90vh] border-r-4 border-red-500 flex flex-col';
            
            title.textContent = `Ø§Ù„ÙŠÙˆÙ… ${day}: ${getDayName(day)}`;
            
            content.innerHTML = `
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Ø§Ù„ÙØ±Ø§Ø¦Ø¶:</span>
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-green-600">${dayData.fard}/5</span>
                            <span class="text-sm text-gray-500">(${fardPercentage}%)</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Ø§Ù„Ù†ÙˆØ§ÙÙ„:</span>
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-amber-600">${dayData.nafl}/3</span>
                            <span class="text-sm text-gray-500">(${naflPercentage}%)</span>
                        </div>
                    </div>
                    <hr class="border-gray-200">
                    <div class="flex justify-between items-center">
                        <span class="font-medium text-gray-700">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                        <span class="font-bold text-lg text-blue-600">${totalPercentage}%</span>
                    </div>
                    <div class="mt-6 flex gap-3">
                        <button onclick="editDay(${day})" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            ØªØ¹Ø¯ÙŠÙ„
                        </button>
                        <button onclick="hideModal()" class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition-colors">
                            Ø¥ØºÙ„Ø§Ù‚
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.add('show');
        }
        
        function hideModal() {
            document.getElementById('modal').classList.remove('show');
        }
        
        function editDay(day) {
            const monthlyData = loadMonthlyData();
            const dayData = monthlyData[day] || {};
            const content = document.getElementById('modal-content');
            
            const dayDate = new Date(new Date().getFullYear(), new Date().getMonth(), day);
            const isFriday = dayDate.getDay() === 5;
            
            const prayerNames = {
                'fajr': 'Ø§Ù„ÙØ¬Ø± (2)', 
                'dhuhr': isFriday ? 'Ø§Ù„Ø¬Ù…Ø¹Ø© (2)' : 'Ø§Ù„Ø¸Ù‡Ø± (4)', 
                'asr': 'Ø§Ù„Ø¹ØµØ± (4)', 
                'maghrib': 'Ø§Ù„Ù…ØºØ±Ø¨ (3)', 
                'isha': 'Ø§Ù„Ø¹Ø´Ø§Ø¡ (4)',
                'fajr-sunnah': 'Ø³Ù†Ø© Ø§Ù„ÙØ¬Ø±', 'duha': 'Ø§Ù„Ø¶Ø­Ù‰', 'witr': 'Ø§Ù„ÙˆØªØ±'
            };
            
            const maxRakaat = { 'fajr': 2, 'dhuhr': isFriday ? 2 : 4, 'asr': 4, 'maghrib': 3, 'isha': 4 };
            
            let fardHtml = '';
            ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'].forEach(prayer => {
                const prayerData = dayData[prayer] || { completed: false, missedRakaat: 0 };
                const isCompleted = isPrayerCompleted(prayerData);
                const missedRakaat = (prayerData && prayerData.missedRakaat) ? prayerData.missedRakaat : 0;
                const isComplete = isCompleted && missedRakaat === 0;
                const isMissed = isCompleted && missedRakaat > 0;
                
                let rakaatOptions = '<option value="0">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙÙˆØ§Øª</option>';
                for (let i = 1; i <= maxRakaat[prayer]; i++) {
                    rakaatOptions += `<option value="${i}" ${missedRakaat === i ? 'selected' : ''}>${i === 1 ? 'Ø±ÙƒØ¹Ø© ÙˆØ§Ø­Ø¯Ø©' : i === 2 ? 'Ø±ÙƒØ¹ØªØ§Ù†' : i + ' Ø±ÙƒØ¹Ø§Øª'}</option>`;
                }
                
                fardHtml += `
                    <div class="border border-gray-200 rounded-lg p-3 space-y-2">
                        <div class="font-medium text-gray-700">${prayerNames[prayer]}</div>
                        <div class="flex gap-2">
                            <button class="flex-1 py-2 px-3 text-xs rounded ${isComplete ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-600'} complete-btn" data-prayer="${prayer}">
                                Ù…ÙƒØªÙ…Ù„Ø© âœ…
                            </button>
                            <select class="flex-1 py-2 px-3 text-xs rounded border missed-select" data-prayer="${prayer}">
                                ${rakaatOptions}
                            </select>
                        </div>
                    </div>
                `;
            });
            
            let naflHtml = '';
            ['fajr-sunnah', 'duha', 'witr'].forEach(prayer => {
                const checked = dayData[prayer] ? 'checked' : '';
                naflHtml += `
                    <label class="flex items-center gap-3 p-2 hover:bg-gray-50 rounded cursor-pointer">
                        <input type="checkbox" ${checked} data-prayer="${prayer}" class="w-5 h-5 text-amber-600">
                        <span class="text-gray-700">${prayerNames[prayer]}</span>
                    </label>
                `;
            });
            
            content.innerHTML = `
                <div class="overflow-y-auto flex-1">
                    <div class="space-y-4">
                        <div class="flex gap-2 mb-4">
                            <button onclick="selectAllPrayers()" class="flex-1 bg-blue-600 text-white px-3 py-2 rounded text-sm hover:bg-blue-700">
                                ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„
                            </button>
                            <button onclick="deselectAllPrayers()" class="flex-1 bg-gray-600 text-white px-3 py-2 rounded text-sm hover:bg-gray-700">
                                Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„
                            </button>
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-medium text-gray-800 mb-3">Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„Ù…ÙØ±ÙˆØ¶Ø©</h4>
                                <div class="space-y-2">
                                    ${fardHtml}
                                </div>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800 mb-3">Ø§Ù„Ù†ÙˆØ§ÙÙ„</h4>
                                <div class="space-y-1 border border-gray-200 rounded-lg p-2">
                                    ${naflHtml}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex gap-3 mt-4 pt-4 border-t border-gray-200 flex-shrink-0">
                    <button onclick="saveEdit(${day})" class="flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                        Ø­ÙØ¸
                    </button>
                    <button onclick="hideModal()" class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition-colors">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                </div>
            `;
            
            // Add event listeners for fard prayers
            document.querySelectorAll('.complete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const prayer = this.dataset.prayer;
                    const missedSelect = document.querySelector(`.missed-select[data-prayer="${prayer}"]`);
                    
                    if (this.classList.contains('bg-green-500')) {
                        this.className = 'flex-1 py-2 px-3 text-xs rounded bg-gray-200 text-gray-600 complete-btn';
                        missedSelect.value = '0';
                    } else {
                        this.className = 'flex-1 py-2 px-3 text-xs rounded bg-green-500 text-white complete-btn';
                        missedSelect.value = '0';
                    }
                });
            });
            
            document.querySelectorAll('.missed-select').forEach(select => {
                select.addEventListener('change', function() {
                    const prayer = this.dataset.prayer;
                    const completeBtn = document.querySelector(`.complete-btn[data-prayer="${prayer}"]`);
                    
                    if (this.value > 0) {
                        completeBtn.className = 'flex-1 py-2 px-3 text-xs rounded bg-orange-500 text-white complete-btn';
                    } else {
                        completeBtn.className = 'flex-1 py-2 px-3 text-xs rounded bg-gray-200 text-gray-600 complete-btn';
                    }
                });
            });
        }
        
        function saveEdit(day) {
            const currentUser = getCurrentUser();
            if (!currentUser) return;
            
            const dayData = {};
            
            // Handle fard prayers
            document.querySelectorAll('.complete-btn').forEach(btn => {
                const prayer = btn.dataset.prayer;
                const isActive = btn.classList.contains('bg-green-500');
                const missedSelect = document.querySelector(`.missed-select[data-prayer="${prayer}"]`);
                const missedRakaat = parseInt(missedSelect.value);
                
                if (isActive && missedRakaat === 0) {
                    dayData[prayer] = { completed: true, missedRakaat: 0 };
                } else if (missedRakaat > 0) {
                    dayData[prayer] = { completed: true, missedRakaat: missedRakaat };
                } else {
                    dayData[prayer] = { completed: false, missedRakaat: 0 };
                }
            });
            
            // Handle nafl prayers
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                dayData[checkbox.dataset.prayer] = checkbox.checked;
            });
            
            const now = new Date();
            const month = now.getMonth() + 1;
            const year = now.getFullYear();
            const key = `prayers_${currentUser}_${year}_${month}`;
            
            let monthData = JSON.parse(localStorage.getItem(key) || '{}');
            monthData[day] = dayData;
            localStorage.setItem(key, JSON.stringify(monthData));
            
            generateCalendar();
            calculateMonthlyStats();
            hideModal();
        }
        
        function changeUser() {
            localStorage.removeItem('currentUser');
            window.location.href = 'user-select.html';
        }
        
        function applyUserTheme() {
            const currentUser = getCurrentUser();
            if (!currentUser) return;
            
            const profile = getUserProfile(currentUser);
            if (!profile) return;
            
            document.getElementById('user-name').textContent = profile.username;
            document.getElementById('user-avatar').textContent = profile.avatar;
            document.getElementById('user-avatar').className = `w-12 h-12 bg-${profile.color}-500 rounded-full flex items-center justify-center text-2xl text-white`;
            document.getElementById('current-month').className = `text-2xl font-bold text-${profile.color}-600`;
        }
        
        function selectAllPrayers() {
            // Select all fard prayers (complete buttons)
            document.querySelectorAll('.complete-btn').forEach(btn => {
                btn.className = 'flex-1 py-2 px-3 text-xs rounded bg-green-500 text-white complete-btn';
                const prayer = btn.dataset.prayer;
                const missedSelect = document.querySelector(`.missed-select[data-prayer="${prayer}"]`);
                if (missedSelect) missedSelect.value = '0';
            });
            
            // Select all nafl prayers (checkboxes)
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = true;
            });
        }
        
        function deselectAllPrayers() {
            // Deselect all fard prayers (complete buttons)
            document.querySelectorAll('.complete-btn').forEach(btn => {
                btn.className = 'flex-1 py-2 px-3 text-xs rounded bg-gray-200 text-gray-600 complete-btn';
                const prayer = btn.dataset.prayer;
                const missedSelect = document.querySelector(`.missed-select[data-prayer="${prayer}"]`);
                if (missedSelect) missedSelect.value = '0';
            });
            
            // Deselect all nafl prayers (checkboxes)
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
        }
        
        function exportToJSON() {
            const currentUser = getCurrentUser();
            if (!currentUser) return;
            
            const profile = getUserProfile(currentUser);
            const now = new Date();
            
            // Collect all prayer data for the user
            const userData = {
                username: profile.username,
                exportDate: now.toISOString(),
                prayerData: {}
            };
            
            // Get all months data
            for (let key in localStorage) {
                if (key.startsWith(`prayers_${currentUser}_`)) {
                    userData.prayerData[key] = JSON.parse(localStorage.getItem(key));
                }
            }
            
            const jsonData = JSON.stringify(userData, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„ØµÙ„Ø§Ø©_${profile.username}_${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}.json`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Show success message
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            toast.textContent = 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!';
            document.body.appendChild(toast);
            setTimeout(() => document.body.removeChild(toast), 3000);
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = getCurrentUser();
            if (!currentUser) return;
            
            applyUserTheme();
            updateCurrentMonth();
            generateCalendar();
            calculateMonthlyStats();
            
            document.getElementById('modal').addEventListener('click', (e) => {
                if (e.target.id === 'modal') {
                    hideModal();
                }
            });
        });
    </script>
    <script src="sidebar.js"></script>
</body>
</html>